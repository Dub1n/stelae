# Stelae MCP Tool Invocation Log - 2025-11-14

- Session opened against `http://127.0.0.1:9090/mcp` and every tool from the current `tools/list` payload was invoked via `tools/call`, per the AGENTS.md directive to rely on real MCP responses.
- Commands were issued with a small Python harness that reuses `dev/debug/chatgpt_connector_probe.py`; the raw "curl-style" transcript (full JSON for each HTTP request/response) lives at `dev/logs/tool_invocations/20251114T104345Z-tool-calls.json`.
- Each tool was also invoked through the MCP bridge (`mcp__stelae__*` adapters) so we can capture what Codex sees when it calls the tool directly; those outputs are summarized below and can be reproduced by reusing the same adapters.
- The table now compares both perspectives so we can spot gaps (double-encoding, schema validation errors, discovery drift, etc.) without rerunning the probes.

| Tool | Operation / arguments | curl response highlight | Direct MCP response highlight | Expected response | Required fixes | Notes | Tester's response highlight |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `doc_fetch_suite` | `{"operation": "list_documentation_sources_tool"}` | Double-encoded string whose inner text is `Available documentation sources: []`. | Direct adapter also returns the same double-encoded JSON string. | Should list configured Docy documentation sources without extra encoding (README.md:140; dev/notes/assessments/e2e-clone-smoke/gpt-5-high.md:60). | Stop double-encoding Docy responses so the result is an object instead of JSON-in-a-string. | Confirms Docy catalog is empty and the wrapper still double-serializes. |  |
| `grep` | `{"pattern": "Stelae", "paths": ["README.md"], "recursive": false, "max_count": 5}` | Structured content reports `No matches found`. | Direct call returns `{"content":[{"text":"No matches found"}],"isError":false}`. | Should stream ripgrep hits (or an empty set) from `${STELAE_DIR}` per the stack snapshot (README.md:12-13). |  | Rg wrapper is reachable in both flows; nested result format persists. |  |
| `manage_docy_sources` | `{"operation": "list_sources"}` | Structured content decodes to `{"sources": [], "catalogPath": ".../config/docy_sources.json", "urlFile": ".../.docy.urls"}`. | Direct adapter surfaces `Output validation error ... is not of type 'object'` because the proxy emits a JSON blob as a string. | Response should be a JSON object describing catalog paths and sources (docs/ARCHITECTURE.md:198). | Ensure the proxy returns a real object (not a stringified blob) so schema validation passes. | Highlights the schema mismatch that Codex reports today. |  |
| `manage_stelae` | `{"operation": "list_discovered_servers"}` | `status: "ok"` with `servers: []`, pointing at `/home/gabri/.config/stelae/discovered_servers.local.json`. | Direct call returns the full discovery list (apecloud-aperag, public_mcp_catalog, qdrant, etc.) from `${STELAE_CONFIG_HOME}/discovered_servers.local.json`. | Should list cached descriptors with the standard `status/details/files_updated/commands_run` envelope (docs/ARCHITECTURE.md:298-305). | Keep the discovery cache in sync before capturing curl logs so both views reflect the current overlay. | CLI curl path read the file before recent updates; MCP bridge sees the populated overlay. |  |
| `memory_suite` | `{"operation": "list_memory_projects"}` | Text lists `main` and `stelae (current, default)`. | Direct call echoes the same two-project list + HTML comment. | Should enumerate Basic Memory projects and mark the current/default workspace (README.md:139). |  | Confirms Basic Memory health in both pathways. |  |
| `scrapling_fetch_suite` | `{"operation": "s_fetch_page", "url": "https://example.com", "mode": "basic", "format": "markdown", "max_length": 2000}` | Metadata block with `total_length`/`retrieved_length` followed by Example Domain markdown. | Direct adapter returns the same metadata + body payload. | Expected to return `{metadata, content}` as described in the Scrapling schema note (README.md:49,141). |  | Demonstrates successful outbound fetch with no truncation. |  |
| `strata_ops_suite` | `{"operation": "discover_server_actions", "user_query": "status endpoints", "server_names": []}` | Structured result is `{"servers":{}}`. | Direct call returns the same empty `{"servers":{}}` blob. | When supplied with concrete `server_names`, should enumerate available actions (README.md:142; config/bundles/starter_bundle.json). | Provide real `server_names` during smoke runs so this suite exercises action discovery instead of returning `{}`. | Need populated `server_names` to exercise richer paths. |  |
| `workspace_fs_read` | `{"operation": "read_file", "path": "README.md"}` | Echoed the entire `~/apps/mcp-proxy/README.md`. | Direct call returns the same MCP proxy README payload. | Filesystem MCP is documented as `--root ${STELAE_DIR}` (README.md:12), so reads should land in this repo rather than the proxy checkout. | Point the filesystem server at `${STELAE_DIR}` before the next audit to keep smoke runs focused on this workspace. | The filesystem server currently targets the proxy repo rather than this project. |  |
| `workspace_fs_write` | `{"operation": "create_directory", "path": "/home/gabri/dev/stelae/dev/tmp/workspace-fs-write-test"}` | `"Service is running in read-only mode..."` | Direct adapter returns the same read-only warning string. | Aggregation describes mutating helpers that should succeed when the server runs with write permissions (README.md:136-138). | Start the filesystem server with write permissions (e.g., `--allow-write`) when destructive operations are required. | Write surface disabled until the fs server restarts with `--allow-write`. |  |
| `workspace_shell_control` | `{"operation": "get_current_directory"}` | Structured result `/home/gabri/apps/mcp-proxy`. | Direct call returns `/home/gabri/apps/mcp-proxy`. | Shell MCP launches with `--workdir {{PHOENIX_ROOT}}` (config/bundles/starter_bundle.json:90-99), so the reported cwd should match that workspace. | Update `PHOENIX_ROOT` (or change directories after launch) so shell ops execute inside the intended repo. | Shell controller is live and currently scoped to the proxy workspace. |  |

These snapshots should make it easy to compare future clone-smoke results (e.g., verifying the Docy wrapper still double-encodes or checking whether `workspace_fs_read` ever points back at the Stelae repo). Use the companion log file whenever a full JSON diff is needed for troubleshooting.
